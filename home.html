<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Busanso Nation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- DATA FILES -->
<script src="movies-data.js"></script>
<script src="series-data.js"></script>

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:'Poppins',sans-serif;
}

/* HEADER */
.header{
  padding:20px;
  text-align:center;
}
.header img{ height:55px; }
.header h1{ margin:8px 0; }

/* BUTTONS */
.top-actions{
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:12px;
  margin-bottom:22px;
  padding:0 10px;
}

.btn{
  padding:12px 22px;
  border-radius:999px;
  font-weight:700;
  text-decoration:none;
  font-size:13px;
  color:#fff;
  letter-spacing:.3px;
  transition:all .25s ease;
  box-shadow:0 6px 16px rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.08);
}

/* INDIVIDUAL BUTTON COLORS */
.subscribe{ background:linear-gradient(135deg,#e50914,#ff4d4d); }
.login{ background:linear-gradient(135deg,#2563eb,#38bdf8); }
.live{ background:linear-gradient(135deg,#16a34a,#4ade80); }
.about{ background:#111; border:1px solid #333; color:#ddd; }
.agents{ background:linear-gradient(135deg,#9333ea,#c084fc); }
.library{ background:linear-gradient(135deg,#f59e0b,#facc15); color:#000; }
.kibanda{ background:linear-gradient(135deg,#14b8a6,#2dd4bf); color:#002; }

/* HOVER EFFECT */
.btn:hover{
  transform:translateY(-2px) scale(1.03);
  box-shadow:0 10px 24px rgba(0,0,0,.5);
  opacity:.95;
}

/* SECTIONS */
.section{ padding:15px; }
.slider{
  display:flex;
  gap:14px;
  overflow-x:auto;
}
.slider::-webkit-scrollbar{ display:none; }

/* CARD */
.card{
  min-width:160px;
  text-align:center;
  position:relative;
}
.card img{
  width:100%;
  border-radius:10px;
}
.card-title{
  margin-top:6px;
  font-size:14px;
  font-weight:600;
}

/* WATCH BUTTON */
.watch-btn{
  margin-top:6px;
  width:100%;
  padding:8px;
  border:none;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
  background:#e50914;
  color:#fff;
}

/* BADGES */
.badge{
  position:absolute;
  top:8px;
  left:8px;
  font-size:11px;
  padding:3px 8px;
  border-radius:6px;
  background:#22c55e;
}
.badge.premium{ background:#e50914; }

/* LOCK ICON */
.lock-icon{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  font-weight:bold;
  background:rgba(0,0,0,0.6);
}

/* FLOATING INSTALL / OPEN APP BUTTON */
#installBtn, #openAppBtn{
  position:fixed;
  bottom:20px;
  right:20px;
  z-index:9999;
  padding:14px 20px;
  border-radius:50px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,.6);
  display:none;
  border:none;
}
#installBtn{ background:#ff7a18; color:#fff; }
#installBtn:hover{ background:#ffb400; }
#openAppBtn{ background:#22c55e; color:#fff; }
#openAppBtn:hover{ background:#16a34a; }

#iosHint{
  position:fixed;
  bottom:20px;
  left:20px;
  right:20px;
  background:#ff7a18;
  padding:14px;
  border-radius:12px;
  font-size:14px;
  display:none;
  text-align:center;
  z-index:9999;
}
</style>
</head>

<body>

<div class="header">
  <img src="https://i.ibb.co/hxgrLF35/BUSANSO-New.png" alt="Logo">
  <h1>Busanso Nation</h1>
  <small>welcome to Busanso Movies & Series. if you hate ads, pay to Watch</small>
</div>

<div class="top-actions">
  <a href="packages.html" class="btn subscribe">Pay to Watch</a>
  <a href="login.html" class="btn login">Login</a>
  <a href="live.html" class="btn live">Live</a>
  <a href="about.html" class="btn about">Are You New?</a>
  <a href="agents.html" class="btn agents">Our Agents</a>
  <a href="library-login.html" class="btn library">Library</a>
  <a href="kibanda-login.html" class="btn kibanda">Kibanda</a>
</div>

<div class="section">
  <h3>Latest Movies</h3>
  <div class="slider" id="moviesBox"></div>
</div>

<div class="ad-banner" style="text-align:center; margin:20px 0;">
  <script>
    atOptions = {
      'key' : '1c9ccdb756a82c4d663014a338917bd7',
      'format' : 'iframe',
      'height' : 250,
      'width' : 300,
      'params' : {}
    };
  </script>
  <script src="https://www.highperformanceformat.com/1c9ccdb756a82c4d663014a338917bd7/invoke.js"></script>
</div>

<div class="section">
  <h3>Latest Series</h3>
  <div class="slider" id="seriesBox"></div>
</div>

<!-- FLOATING APP INSTALL / OPEN APP -->
<button id="installBtn">Install App</button>
<button id="openAppBtn">OPEN APP</button>
<div id="iosHint">Tap <strong>Share â†’ Add to Home Screen</strong> to install this app</div>

<script>
/* ===== REDIRECT IF VALID PIN EXISTS ===== */
(function(){
  var pin = localStorage.getItem("activePIN");
  var exp = Number(localStorage.getItem("pinExpiry"));
  if(pin && exp && Date.now() < exp){
    location.replace("watch.html");
  }
})();

/* ===== CARD CREATOR ===== */
function createCard(item, type){
  var isPremium = item.type === "premium";
  var card = document.createElement("div");
  card.className = "card";

  var html = '';
  html += '<div style="position:relative">';
  html += '<img src="' + item.poster + '">';
  html += '<span class="badge ' + (isPremium ? 'premium' : '') + '">';
  html += isPremium ? 'PREMIUM' : 'FREE';
  html += '</span>';
  if(isPremium){
    html += '<div class="lock-icon">LOCKED</div>';
  }
  html += '</div>';
  html += '<div class="card-title">' + item.title + '</div>';
  html += '<button class="watch-btn">' + (isPremium ? 'Pay to Watch' : 'Watch') + '</button>';

  card.innerHTML = html;

  if(!isPremium){
    card.querySelector(".watch-btn").onclick = function(){
      if(type === "movie"){
        location.href = "movie.html?id=" + item.id;
      }else{
        location.href = "serie.html?id=" + item.id;
      }
    };
  }
  return card;
}

/* ===== RENDER MOVIES ===== */
var moviesBox = document.getElementById("moviesBox");
for(var i=0;i<MOVIES.length;i++){
  moviesBox.appendChild(createCard(MOVIES[i],"movie"));
}

/* ===== RENDER SERIES ===== */
var seriesBox = document.getElementById("seriesBox");
for(var j=0;j<SERIES.length;j++){
  seriesBox.appendChild(createCard(SERIES[j],"series"));
}

/* ===== APP INSTALL / OPEN APP LOGIC ===== */
let deferredPrompt;
const installBtn = document.getElementById('installBtn');
const openBtn = document.getElementById('openAppBtn');
const iosHint = document.getElementById('iosHint');

function isInStandaloneMode() {
  return window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
}
function isiOS() { return /iphone|ipad|ipod/i.test(navigator.userAgent); }
function isAndroid() { return /android/i.test(navigator.userAgent); }

// Detect if running in your installed WebView app
// For example, your app sets a custom user agent or query param like "?webview=true"
function isInWebviewApp(){
  return navigator.userAgent.includes("BusansoWebView") || location.search.includes("webview=true");
}

if(!isInStandaloneMode() && !isInWebviewApp()){
  // Android PWA install
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    if(isAndroid()){
      installBtn.style.display = 'block';
      installBtn.addEventListener('click', async () => {
        installBtn.style.display = 'none';
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
      });
    }
  });

  // iOS hint
  if(isiOS()){
    iosHint.style.display = 'block';
  }

  // Open app button for external browser only
  openBtn.style.display = 'block';
  openBtn.addEventListener('click', () => {
    // Navigate to app URL (custom scheme or main PWA page)
    window.location.href = "index.html?webview=true";
  });
}

// Hide all buttons if app is installed
window.addEventListener('appinstalled', () => {
  installBtn.style.display = 'none';
  openBtn.style.display = 'none';
  iosHint.style.display = 'none';
});
</script>

<!-- Adsterra Ad -->
<script src="https://pl28597623.effectivegatecpm.com/47/af/6b/47af6bb4248b5c79dabea6b329d6d72f.js"></script>
</body>
</html>
