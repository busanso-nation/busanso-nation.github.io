<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Series Player</title>
<style>
body { font-family: Arial,sans-serif; margin:0; background:#111; color:#fff; }
#seriesInfo { max-width:900px; margin:20px auto; padding:10px; }
#seriesTitle { font-size:24px; margin-bottom:5px; }
#seriesDesc { font-size:16px; color:#ccc; margin-bottom:15px; }
#playerContainer { display:none; background:#000; padding:15px; max-width:900px; margin:0 auto 20px; border-radius:8px; }
#videoPlayer { width:100%; height:500px; border:none; border-radius:8px; }
.controls { text-align:center; margin-top:10px; }
.controls button { padding:8px 12px; margin:0 5px; background:#ff4444; border:none; border-radius:6px; cursor:pointer; color:#fff; }
#episodeList { max-width:900px; margin:0 auto 20px; display:flex; flex-wrap:wrap; gap:10px; }
#episodeList button { flex:1 1 30%; padding:8px; background:#222; border:none; border-radius:6px; color:#fff; cursor:pointer; }
#episodeList button.active, #episodeList button:hover { background:#ff3b3b; }
#seriesSelector { max-width:900px; margin:20px auto; display:flex; flex-wrap:wrap; gap:10px; }
#seriesSelector button { flex:1 1 30%; padding:8px; background:#222; border:none; border-radius:6px; color:#fff; cursor:pointer; }
#seriesSelector button:hover { background:#ff3b3b; }
</style>
</head>
<body>

<div id="seriesSelector"></div>

<div id="seriesInfo">
  <div id="seriesTitle"></div>
  <div id="seriesDesc"></div>
</div>

<div id="playerContainer">
  <iframe id="videoPlayer" allowfullscreen allow="autoplay; encrypted-media"></iframe>
  <div class="controls">
    <button id="prevBtn" style="display:none;">Previous Episode</button>
    <button id="nextBtn" style="display:none;">Next Episode</button>
  </div>
</div>

<div id="episodeList"></div>

<script src="series-data.js"></script>
<script>
let currentSeries = null;
let currentEpisodeIndex = 0;
let saveInterval;

// Populate series selector
function initSeriesSelector() {
  const selector = document.getElementById('seriesSelector');
  seriesData.forEach((series, idx) => {
    const btn = document.createElement('button');
    btn.textContent = series.title;
    btn.addEventListener('click', () => loadSeries(idx));
    selector.appendChild(btn);
  });
}

// Load a series
function loadSeries(index) {
  currentSeries = seriesData[index];
  currentEpisodeIndex = 0;
  document.getElementById('seriesTitle').textContent = currentSeries.title;
  document.getElementById('seriesDesc').textContent = currentSeries.description;

  populateEpisodeList();
  loadSavedEpisode();
  toggleNavButtons();
}

// Populate episode buttons
function populateEpisodeList() {
  const list = document.getElementById('episodeList');
  list.innerHTML = '';
  currentSeries.episodes.forEach((url, idx) => {
    const btn = document.createElement('button');
    btn.textContent = "Episode " + (idx+1);
    btn.addEventListener('click', () => {
      currentEpisodeIndex = idx;
      playEpisode(url);
      toggleNavButtons();
    });
    list.appendChild(btn);
  });
}

// Play episode
function playEpisode(url, startTime=0) {
  const player = document.getElementById('videoPlayer');
  const container = document.getElementById('playerContainer');

  if(url.includes("youtube.com")) {
    let videoId = url.includes("embed") ? url.split("/embed/")[1] : new URL(url).searchParams.get("v");
    player.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1&start=${startTime}`;
  } else if(url.includes("vimeo.com")) {
    let parts = url.split("/");
    let videoId = parts.pop() || parts.pop();
    player.src = `https://player.vimeo.com/video/${videoId}#t=${startTime}s`;
  } else if(url.includes("drive.google.com")) {
    player.src = url; // Only /preview links
  } else {
    player.src = url;
  }

  container.style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });

  updateActiveEpisode();
  if(saveInterval) clearInterval(saveInterval);
  saveInterval = setInterval(() => {
    localStorage.setItem(currentSeries.title, JSON.stringify({
      index: currentEpisodeIndex,
      time: startTime
    }));
  }, 5000);
}

// Load saved episode
function loadSavedEpisode() {
  const saved = JSON.parse(localStorage.getItem(currentSeries.title));
  if(saved && saved.index < currentSeries.episodes.length){
    currentEpisodeIndex = saved.index;
    playEpisode(currentSeries.episodes[currentEpisodeIndex], saved.time);
  } else {
    playEpisode(currentSeries.episodes[currentEpisodeIndex]);
  }
}

// Next/Prev buttons
document.getElementById('nextBtn').addEventListener('click', () => {
  if(currentEpisodeIndex < currentSeries.episodes.length -1){
    currentEpisodeIndex++;
    playEpisode(currentSeries.episodes[currentEpisodeIndex]);
    toggleNavButtons();
  }
});
document.getElementById('prevBtn').addEventListener('click', () => {
  if(currentEpisodeIndex > 0){
    currentEpisodeIndex--;
    playEpisode(currentSeries.episodes[currentEpisodeIndex]);
    toggleNavButtons();
  }
});

function toggleNavButtons() {
  document.getElementById('nextBtn').style.display = currentEpisodeIndex < currentSeries.episodes.length -1 ? 'inline-block' : 'none';
  document.getElementById('prevBtn').style.display = currentEpisodeIndex > 0 ? 'inline-block' : 'none';
}

function updateActiveEpisode() {
  document.querySelectorAll('#episodeList button').forEach((btn, idx) => {
    btn.classList.toggle('active', idx === currentEpisodeIndex);
  });
}

// Initialize everything after page load
window.addEventListener('DOMContentLoaded', () => {
  initSeriesSelector();
  if(seriesData.length > 0){
    loadSeries(0); // Load first series automatically
  }
});
</script>
</body>
</html>
