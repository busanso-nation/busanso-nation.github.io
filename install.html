<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Install BUSANSO NATION App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
<link rel="apple-touch-icon" href="icons/icon-192.png">

<style>
body{
  margin:0;
  height:100vh;
  font-family:'Segoe UI',sans-serif;
  background:radial-gradient(circle at top,#102a1d,#000);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
}

.card{
  text-align:center;
  max-width:360px;
  padding:30px;
}

.logo{
  font-size:2.4rem;
  font-weight:800;
  letter-spacing:3px;
}
.nation{color:#e50914}

.tagline{
  margin:12px 0 20px;
  color:#f1c40f;
}

button{
  padding:14px 26px;
  font-size:16px;
  border:none;
  cursor:pointer;
  background:#e50914;
  color:#fff;
  border-radius:6px;
}

button:hover{opacity:.9}

.ios{
  margin-top:20px;
  font-size:.95rem;
  display:none;
}
</style>
</head>

<body>

<div class="card">
  <div class="logo">BUSANSO <span class="nation">NATION</span></div>
  <div class="tagline">Install the official app</div>

  <button id="installBtn" style="display:none;">Install App</button>

  <div class="ios" id="iosHint">
    On iPhone:<br>
    Tap <strong>Share → Add to Home Screen</strong>
  </div>
</div>

<script>
const installBtn = document.getElementById("installBtn");
const iosHint = document.getElementById("iosHint");

let deferredPrompt = null;

/* 1️⃣ Redirect if already installed */
if (
  window.matchMedia('(display-mode: standalone)').matches ||
  window.navigator.standalone === true
) {
  location.replace("home.html");
}

/* 2️⃣ Register service worker */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}

/* 3️⃣ Always show button (but disable if needed) */
installBtn.style.display = "inline-block";
installBtn.textContent = "Checking availability…";
installBtn.disabled = true;

/* 4️⃣ Detect install availability */
window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.textContent = "Install App";
  installBtn.disabled = false;
});

/* 5️⃣ Button click */
installBtn.addEventListener("click", async () => {
  if (!deferredPrompt) {
    alert("Install option will appear after you interact with the site.");
    return;
  }
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
});

/* 6️⃣ Track + redirect after install */
window.addEventListener("appinstalled", () => {
  trackInstall();
  location.replace("home.html");
});

/* 7️⃣ iPhone fallback */
const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
if (isIOS && !window.matchMedia('(display-mode: standalone)').matches) {
  iosHint.style.display = "block";
  installBtn.style.display = "none";
}

/* 8️⃣ Local install tracking */
function trackInstall(){
  let count = localStorage.getItem("installCount");
  count = count ? Number(count) + 1 : 1;
  localStorage.setItem("installCount", count);
  console.log("Local installs:", count);
}
</script>

</body>
</html>
