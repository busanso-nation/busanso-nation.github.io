<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BUSANSO â€“ Movie Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Movies data -->
<script src="movies-data.js"></script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Plyr -->
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,sans-serif;
}

/* ===== PLAYER (BIG & CINEMATIC) ===== */
.player{
  width:100%;
  height:56.25vw; /* 16:9 */
  max-height:85vh;
  background:#000;
}

.player video,
.player iframe{
  width:100%;
  height:100%;
}

/* ===== DETAILS ===== */
.details{
  padding:16px;
  max-width:1100px;
  margin:0 auto;
}
.meta{color:#aaa;font-size:14px;margin-bottom:10px}
.watch{
  background:#e50914;
  color:#fff;
  font-size:20px;
  padding:16px;
  width:100%;
  border:none;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
  margin-bottom:10px;
}
.share{
  background:#222;
  color:#fff;
  font-size:16px;
  padding:14px;
  width:100%;
  border:none;
  border-radius:12px;
  cursor:pointer;
}
.share-options{
  display:none;
  margin-top:10px;
  gap:10px;
}
.share-options button{
  flex:1;
  padding:12px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}
.whatsapp{background:#25D366;color:#000}
.imo{background:#00b2ff;color:#000}
.tiktok{background:#000;color:#fff;border:1px solid #333}

/* ===== COMMENTS ===== */
#commentsSection{
  max-width:1100px;
  margin:20px auto;
  background:#111;
  padding:16px;
  border-radius:14px;
}
#commentsList div{
  background:#222;
  padding:8px 10px;
  border-radius:8px;
  margin-bottom:6px;
  position:relative;
}
#usernameInput,#commentInput{
  width:100%;
  padding:10px;
  border-radius:6px;
  background:#111;
  color:#fff;
  border:none;
  margin-bottom:8px;
}
#commentBtn{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:#e50914;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- PLAYER -->
<div class="player">
  <video id="player" controls crossorigin playsinline></video>
</div>

<!-- DETAILS -->
<div class="details">
  <h1 id="title"></h1>
  <div class="meta" id="meta"></div>

  <button class="watch" id="watchBtn">â–¶ Watch Movie</button>
  <button class="share" id="shareBtn">ðŸ”— Share Movie</button>

  <div class="share-options" id="shareOptions">
    <button class="whatsapp" id="shareWhatsapp">WhatsApp</button>
    <button class="imo" id="shareImo">IMO</button>
    <button class="tiktok" id="shareTiktok">TikTok</button>
  </div>

  <div id="adBox" style="display:none;margin-top:10px"></div>

  <p id="synopsis"></p>
</div>

<!-- COMMENTS -->
<div id="commentsSection">
  <h3>Comments</h3>
  <input id="usernameInput" placeholder="Your nickname">
  <div id="commentsList"></div>
  <textarea id="commentInput" placeholder="Write your comment"></textarea>
  <button id="commentBtn">Post Comment</button>
</div>

<!-- Plyr -->
<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyBGGV9F3Nv13nRJ8t4QCP5Y0IosmKfYz1s",
  authDomain: "busanso-pins.firebaseapp.com",
  databaseURL: "https://busanso-pins-default-rtdb.firebaseio.com",
  projectId: "busanso-pins",
  storageBucket: "busanso-pins.firebasestorage.app",
  messagingSenderId: "137040014808",
  appId: "1:137040014808:web:b0684e17b6b0328da596ad"
});
</script>

<script>
/* ===== LOAD MOVIE ===== */
const params = new URLSearchParams(location.search);
const id = params.get("id");
const movie = MOVIES.find(m => m.id === id);
if(!movie) location.replace("movies.html");

/* ===== INFO ===== */
title.textContent = movie.title;
meta.textContent = movie.country + " â€¢ " + movie.year;
synopsis.textContent = movie.synopsis || "";

/* ===== PLAYER ===== */
const player = new Plyr('#player',{autoplay:true});

/* ===== VIDEO NORMALIZATION ===== */
function normalizeVideo(url){
  if(url.includes("youtube")) return {type:"youtube",src:new URL(url).searchParams.get("v")};
  if(url.includes("youtu.be")) return {type:"youtube",src:url.split("/").pop()};
  if(url.includes("vimeo")) return {type:"vimeo",src:url.split("/").pop()};
  const m = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
  if(m) return {type:"video",src:`https://drive.google.com/uc?export=media&id=${m[1]}`};
  return {type:"video",src:url};
}

function loadMovie(fullscreen=false){
  const v = normalizeVideo(movie.video);
  if(v.type==="youtube") player.source={type:"youtube",sources:[{src:v.src,provider:"youtube"}]};
  else if(v.type==="vimeo") player.source={type:"vimeo",sources:[{src:v.src,provider:"vimeo"}]};
  else player.source={type:"video",sources:[{src:v.src,type:"video/mp4"}]};
  player.play();
  if(fullscreen) player.fullscreen.enter();
}

window.addEventListener("load",()=>loadMovie());
watchBtn.onclick=()=>loadMovie(true);

/* ===== SHARE ===== */
shareBtn.onclick=()=>shareOptions.style.display=
  shareOptions.style.display==="flex"?"none":"flex";
</script>

</body>
</html>
